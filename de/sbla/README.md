## Анализ изменений в полях JSON-документа 
### Общая постановка
- на входе - [json-файл](/de/sbla/data.json), изменяемый во времени, с документами в структуре dataset
- необходимо отслеживать изменения, возникащие в структуре кадого документа для построения:
  - отчета по набору новых документов в структуре dataset (поле identifier уникально, поле modified - доверенная дата изменения)
  - отчета по перечню изменяемых данных (добавленные/измененные поля)
  - отчета по Топ-5 измененных полей в каждом документе
### Схема решения
- Разворачивание json в плоскую структуру (id, modified, path, value, type), где:
  - id: identifier документа в dataset
  - modified: дата изменения
  - path: путь (с разделителем "=>") к конечному неструктурному элементу (элементы массивов представлены индексами)
  - value: значение конечного элемента
  - type: тип элемента из spark-inferred-схемы
- Оценка разности между текущей и предыдущей версией строковых представлений значений через jaro-winkler similarity (1-distance)
- Построение отчетов (как форма теста)
### Подготовка
- Для целей тестирования:
  - входной файл копириуем в файл ["условной текущей даты"](/de/sbla/2023-05-21.data.json)
  - строим файл ["условной следующей даты"](/de/sbla/2023-05-21.data.json):
    - [Модифицируем поля исходного документа](/de/sbla/gen_data.py#L17); 
    - в "новых" документах (10 штук) - [изменяем идентификатор](/de/sbla/gen_data.py#L32) 
    - в ["модифицированных документах"](/de/sbla/gen_data.py#L36) (10 штук) - меняем 7 полей (включая структурные + добавление), не меняя идентификатор (7 * 10 = 70 изменных полей)
### Обработка подготовленных данных
  - [Разворачиваем json-ы в flat-представление](/de/sbla/src/scripts/data_flat.py#L13), раскладываем [по датам](/de/sbla/src/scripts/data_flat.py#L83) (/flat/processed=..)
  - [Считаем разность между двумя датами](/de/sbla/src/scripts/data_diff.py#L17), с добавлением jws для измененных value с идентичным path в json (/diff/processed=..)
  - В рамках [теста](/de/sbla/src/scripts/test.py) выводим отчеты в качестве PoC возможной работы через BI
  - Результаты теста [доступны в виде файла](/de/sbla/src/submitters/test.all.result.txt)
